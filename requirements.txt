# Game Texture Sorter - Dependencies
# Author: Dead On The Inside / JosephsDeadish
#
# Installation:
#   pip install -r requirements.txt
#
# For minimal installation (GUI + basic sorting):
#   pip install -r requirements-minimal.txt
#
# Platform-specific notes:
#   - Linux: Some dependencies require system libraries (see INSTALL.md)
#   - Windows: All dependencies work out of the box
#   - macOS: May require Xcode command line tools

# ============================================================================
# CORE DEPENDENCIES (Required for basic functionality)
# ============================================================================

# ============================================================================
# UI FRAMEWORK (REQUIRED - ONLY SUPPORTED UI)
# ============================================================================
# Qt6/PyQt6 is the ONLY supported UI framework. No tkinter, no canvas, no legacy UI.
# All UI components (tabs, buttons, layouts, events) use Qt6 widgets.
# 3D rendering and animations use OpenGL for hardware acceleration.
PyQt6>=6.6.0  # Qt6 framework - native UI widgets, event system, state machine
PyQt6-sip>=13.6.0  # SIP bindings for PyQt6 (installed by PyQt6, listed for PyInstaller)
PyOpenGL>=3.1.7  # OpenGL for 3D rendering and skeletal animations
PyOpenGL-accelerate>=3.1.7  # Hardware acceleration for PyOpenGL

# ============================================================================
# IMAGE PROCESSING & CORE DEPENDENCIES
# ============================================================================

# Image Processing
pillow>=10.0.0  # Image loading and processing
darkdetect>=0.8.0  # System dark mode detection
opencv-python>=4.8.1.78  # Computer vision (>= 4.8.1.78 for libwebp CVE fix)
numpy>=1.24.0  # Numerical operations and array processing
scikit-image>=0.21.0  # Image processing algorithms
scipy>=1.10.0  # Scientific computing (used as fallback for alpha correction filters)

# Machine Learning (Core)
scikit-learn>=1.3.0  # Classification and clustering algorithms

# File Operations
send2trash>=1.8.2  # Safe file deletion
watchdog>=3.0.0  # File system monitoring

# Performance
psutil>=5.9.5  # System resource monitoring
tqdm>=4.66.0  # Progress bars
xxhash>=3.4.0  # Fast hashing for file integrity

# Archive Support
py7zr>=0.20.1  # 7z archive extraction (>= 0.20.1 for security fixes)
rarfile>=4.0  # RAR archive extraction (requires unrar utility on system)

# Hotkeys
pynput>=1.7.6  # Global keyboard hotkey support

# Utilities
colorama>=0.4.6  # Cross-platform colored terminal output
pyyaml>=6.0  # YAML configuration file support
requests>=2.31.0  # HTTP requests for online features

# ============================================================================
# OPTIONAL DEPENDENCIES (Enhanced features - gracefully degrade if missing)
# ============================================================================

# SVG Support (Optional)
# ----------------------
# Two modes available:
#
# 1. OFFLINE MODE (Recommended) - Raster to SVG vector tracing
#    Requires: Native Rust module (build with: cd native && maturin develop --release)
#    Features: Convert PNG/JPEG to SVG, no external dependencies, fast
#    Dependencies: None (pure Rust via vtracer)
#
# 2. ONLINE MODE (Optional) - SVG to Raster conversion only
#    Requires: cairosvg + system Cairo libraries
#    Features: Load existing SVG files as raster images
#    Dependencies: Listed below
#
# Linux: sudo apt-get install libcairo2-dev libffi-dev (Ubuntu/Debian)
#        sudo dnf install cairo-devel libffi-devel (Fedora/RHEL)
# macOS: brew install cairo libffi
# Windows: Works out of the box (bundled libraries)
cairosvg>=2.7.0  # SVG to raster conversion (optional, only for loading SVG files)
cairocffi>=1.6.0  # Cairo FFI bindings (dependency of cairosvg)

# AI/ML - ONNX Runtime (Inference side — recommended for all installs)
# ============================================================================
# HYBRID ARCHITECTURE: ONNX for inference, PyTorch for training (optional).
#
# ONNX Runtime is the inference runtime used by the main app pipelines:
#   src/ai/inference.py    → OnnxInferenceSession, run_batch_inference
#   src/ai/offline_model.py → OfflineModel (classification)
#
# Why ONNX for inference?
#   ✅ Starts faster (no JIT compilation)    ✅ Lower memory overhead
#   ✅ Easier multi-threading                ✅ Predictable performance
#   ✅ EXE-safe (compact native DLL)         ✅ Works on old/weak hardware
#   ✅ No torch dependency at runtime
#
# The app degrades gracefully without it (features disabled, no crash).
onnxruntime>=1.16.0  # ONNX inference runtime — batch pipelines & classification

# ============================================================================
# DEEP LEARNING DEPENDENCIES (Optional — training side only)
# ============================================================================
# PyTorch is the TRAINING runtime. It is NOT required for normal app operation.
# Install only if you want to:
#   • Train custom upscalers or texture classifiers
#   • Fine-tune segmentation models
#   • Use advanced vision models (CLIP, DINOv2, EfficientNet)
#
# Training workflow:
#   1. Train with PyTorchTrainer  (src/ai/training_pytorch.py)
#   2. Export to ONNX             (trainer.export_checkpoint("model.onnx"))
#   3. Load in inference pipeline (OnnxInferenceSession("model.onnx"))
#
# Note: torch alone is ~700MB download.
# GPU support: See https://pytorch.org/get-started/locally/ for CUDA versions

# PyTorch Framework (training side)
torch>=2.6.0  # Deep learning framework (>= 2.6.0 for torch.load RCE fix)
torchvision>=0.21.0  # Computer vision models and transforms

# ONNX Model Export/Import (for PyTorch → ONNX conversion)
# NOTE: onnx.reference module may cause issues with PyInstaller — handled by hooks
onnx>=1.14.0  # ONNX model format — needed for PyTorch model export (optional)
# onnxscript>=0.1.0  # Optional ONNX scripting (uncomment if needed)

# Transformer Models
transformers>=4.48.0  # CLIP, ViT models (>= 4.48.0 for security fixes)
timm>=0.9.0  # Image models (EfficientNet, ResNet, etc.)
open-clip-torch>=2.20.0  # Open-source CLIP implementation

# Vector Similarity Search (optional - comment out if install fails on your platform)
# faiss-cpu>=1.7.4  # Fast similarity search (use faiss-gpu for CUDA) - uncomment to enable
# chromadb>=0.4.0  # Vector database for embeddings - uncomment to enable
# annoy>=1.17.0  # Approximate nearest neighbor search - uncomment to enable

# Image Upscaling and Super-Resolution
basicsr>=1.4.2  # Super-resolution models framework
realesrgan>=0.3.0  # Real-ESRGAN upscaling models

# OCR for UI Text Detection
pytesseract>=0.3.10  # Tesseract OCR wrapper (requires tesseract-ocr system package)

# ============================================================================
# DEVELOPMENT DEPENDENCIES (Optional - for development only)
# ============================================================================

# Build & Packaging
pyinstaller>=6.0.0  # Create standalone executables (>= 6.0.0 for security fixes)

# Testing (uncomment if needed for development)
# pytest>=7.4.0  # Testing framework
# pytest-cov>=4.1.0  # Code coverage
# pytest-mock>=3.11.0  # Mocking utilities

# Linting and Code Quality (uncomment if needed for development)
# flake8>=6.1.0  # Code style checker
# pylint>=3.0.0  # Advanced linting
# black>=23.7.0  # Code formatter
# mypy>=1.5.0  # Type checking

# ============================================================================
# NOTES
# ============================================================================
#
# Minimal Installation (GUI + basic sorting only):
#   - Does NOT include: torch, transformers, upscaling models
#   - See requirements-minimal.txt for a lightweight option
#
# GPU Support:
#   - Replace 'faiss-cpu' with 'faiss-gpu' for GPU acceleration
#   - Install CUDA-enabled PyTorch from https://pytorch.org/
#
# Platform-Specific System Dependencies:
#
#   Ubuntu/Debian:
#     sudo apt-get install libcairo2-dev libffi-dev unrar tesseract-ocr
#
#   Fedora/RHEL/CentOS:
#     sudo dnf install cairo-devel libffi-devel unrar tesseract
#
#   macOS:
#     brew install cairo libffi tesseract
#
#   Windows:
#     - All Python packages work out of the box
#     - For RAR support: Install WinRAR or 7-Zip
#     - For OCR: Install Tesseract from https://github.com/UB-Mannheim/tesseract/wiki
#
# Security:
#   - Keep dependencies updated: pip install -r requirements.txt --upgrade
#   - Monitor for vulnerabilities: pip audit (requires pip >= 23.0)
#   - Key security updates applied:
#     * opencv-python >= 4.8.1.78 (libwebp CVE fix)
#     * transformers >= 4.48.0 (deserialization vulnerabilities)
#     * pyinstaller >= 6.0.0 (privilege escalation fixes)
#   - NOTE: Pillow 12.1.1+ recommended for latest PSD security fix, but may 
#     break compatibility with some older code. Test before upgrading.
#

# AI Background Removal Tool (Optional for background removal feature)
# IMPORTANT: Must be installed with [cpu] or [gpu] extras to include onnxruntime backend
# The background removal tool in the application uses this when available.
# NOTE: rembg is excluded from the PyInstaller build (see build_spec_onefolder.spec)
# because rembg.bg calls sys.exit(1) at import time when onnxruntime DLL init fails
# in PyInstaller's isolated analysis subprocesses. Install for development/runtime use.
rembg[cpu]>=2.0.50  # AI-powered background removal with CPU backend (optional)

# Image Metadata
piexif>=1.1.3  # EXIF metadata reading/writing for batch rename
